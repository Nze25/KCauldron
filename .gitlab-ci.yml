# This file is generated by GitLab CI
Source test:
  script:
    - rm -rf $(grep path .gitmodules | awk '{print $3}')
    - git submodule update --init --recursive
    - ./gradlew clean setupCauldron jar
    - rm -rf $(grep path .gitmodules | awk '{print $3}')
  tags:
    - test
  except:
    - tags

Deploy:
  script:
    - rm -rf $(grep path .gitmodules | awk '{print $3}')
    - git submodule update --init --recursive
    - ./gradlew -PofficialBuild clean setupCauldron publish
    - rm -rf $(grep path .gitmodules | awk '{print $3}')
  type: deploy
  tags:
    - deploy
  only:
    - master
    - backport-1448
    - backport-1388
    - backport-1370
    - backport-1291
    - backport-1240

Merge master into backport-1448:
  script:
    - rm -rf $(grep path .gitmodules | awk '{print $3}')
    - from=master
    - to=backport-1448
    - git remote set-url origin gitlab@prok.pw:Prototik/KCauldron.git
    - git fetch origin $to
    - git checkout $to
    - git reset --hard origin/$to
    - git merge origin/$from
    - git push origin $to
    - rm -rf $(grep path .gitmodules | awk '{print $3}')
  type: deploy
  tags:
    - merge-backport
  only:
    - master

Merge backport-1448 into backport-1388:
  script:
    - rm -rf $(grep path .gitmodules | awk '{print $3}')
    - from=backport-1448
    - to=backport-1388
    - git remote set-url origin gitlab@prok.pw:Prototik/KCauldron.git
    - git fetch origin $to
    - git checkout $to
    - git reset --hard origin/$to
    - git merge origin/$from
    - git push origin $to
    - rm -rf $(grep path .gitmodules | awk '{print $3}')
  type: deploy
  tags:
    - merge-backport
  only:
    - backport-1448

Merge backport-1388 into backport-1370:
  script:
    - rm -rf $(grep path .gitmodules | awk '{print $3}')
    - from=backport-1388
    - to=backport-1370
    - git remote set-url origin gitlab@prok.pw:Prototik/KCauldron.git
    - git fetch origin $to
    - git checkout $to
    - git reset --hard origin/$to
    - git merge origin/$from
    - git push origin $to
    - rm -rf $(grep path .gitmodules | awk '{print $3}')
  type: deploy
  tags:
    - merge-backport
  only:
    - backport-1388

Merge backport-1370 into backport-1291:
  script:
    - rm -rf $(grep path .gitmodules | awk '{print $3}')
    - from=backport-1370
    - to=backport-1291
    - git remote set-url origin gitlab@prok.pw:Prototik/KCauldron.git
    - git fetch origin $to
    - git checkout $to
    - git reset --hard origin/$to
    - git merge origin/$from
    - git push origin $to
    - rm -rf $(grep path .gitmodules | awk '{print $3}')
  type: deploy
  tags:
    - merge-backport
  only:
    - backport-1370

Merge backport-1291 into backport-1240:
  script:
    - rm -rf $(grep path .gitmodules | awk '{print $3}')
    - from=backport-1291
    - to=backport-1240
    - git remote set-url origin gitlab@prok.pw:Prototik/KCauldron.git
    - git fetch origin $to
    - git checkout $to
    - git reset --hard origin/$to
    - git merge origin/$from
    - git push origin $to
    - rm -rf $(grep path .gitmodules | awk '{print $3}')
  type: deploy
  tags:
    - merge-backport
  only:
    - backport-1291
